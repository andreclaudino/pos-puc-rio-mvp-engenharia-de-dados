bundle:
  name: ingest-awin

resources:
  jobs:
    ingest_to_bronze:
      name: ingest_to_bronze

      email_notifications:
       on_failure:
         - ceberiloclaus@gmail.com

      tasks:
        - task_key: common_fields_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - default_product_info
              - --source-feed-url
              - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: recommended_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - recommended_metadata
              - --source-feed-url
              - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price,merchant_name,merchant_id,category_name,category_id,aw_image_url,currency,store_price,delivery_cost,merchant_deep_link,language,last_updated,display_price,data_feed_id/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: specification_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - product_specifications
              - --source-feed-url
              - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price,brand_name,brand_id,colour,product_short_description,specifications,condition,product_model,model_number,dimensions,keywords,promotional_text,product_type/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: category_hierarchy_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - category_hierarchy
              - --source-feed-url
              - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price,commission_group,merchant_product_category_path,merchant_product_second_category,merchant_product_third_category/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: product_prices_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - pricing_and_savings
              - --source-feed-url
              - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price,rrp_price,saving,savings_percent,base_price,base_price_amount,base_price_text,product_price_old/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: images_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - product_images
              - --source-feed-url
              - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price,merchant_thumb_url,large_image,alternate_image,aw_thumb_url,alternate_image_two,alternate_image_three,alternate_image_four/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: ratings_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - ratings_and_reviews
              - --source-feed-url
              - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price,reviews,average_rating,rating,number_available/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: product_identifiers_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - product_identifiers
              - --source-feed-url
              - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price,ean,isbn,upc,mpn,parent_product_id,product_GTIN/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

      environments:
        - environment_key: default
          spec:
            environment_version: "4"
            dependencies:
              - ../dist/*.whl
