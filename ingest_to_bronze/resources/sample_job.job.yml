bundle:
  name: ingest-awin

resources:
  jobs:
    ingest_to_bronze:
      name: ingest_to_bronze

      email_notifications:
       on_failure:
         - ceberiloclaus@gmail.com

      tasks:
      - task_key: common_fields_bronze
        
        python_wheel_task:
          package_name: ingest_to_bronze
          entry_point: download_feed
          parameters:
            - "--catalog"
            - "mvp"
            - "--schema"
            - "bronze_feeds"
            - --table
            - common_fields
            - --source-feed-url
            - "https://productdata.awin.com/datafeed/download/apikey/74332bfbefa939bf2fbd94f4fbfd6e3d/language/pt/fid/44669,46605,47729,47753,50585,51837,51987,52631,53075,53089,53091,58413,58627,63901,75921,79509,91869,91942,93360,98680,109288/rid/0/hasEnhancedFeeds/0/columns/aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price/format/csv/delimiter/%2C/compression/gzip/adultcontent/1/"
            - --remove-all-null-columns
            - --write-mode
            - overwrite
            - --metadata-path
            - /Workspace/${workspace.file_path}/metadata/bronze-table-descriptors.json"
        environment_key: default


      environments:
        - environment_key: default
          spec:
            environment_version: "4"
            dependencies:
              - ../dist/*.whl


