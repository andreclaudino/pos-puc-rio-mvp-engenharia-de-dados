bundle:
  name: ingest-awin

resources:
  jobs:
    ingest_to_bronze:
      name: ingest_to_bronze

      email_notifications:
       on_failure:
         - ceberiloclaus@gmail.com

      tasks:
        - task_key: common_fields_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - default_product_info
              - --source-feed-url
              - /Volumes/workspace/awin_products/raw_data/awin_feed_data/default_product_info.csv.gz
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: recommended_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - recommended_metadata
              - --source-feed-url
              - /Volumes/workspace/awin_products/raw_data/awin_feed_data/recommended_metadata.csv.gz
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: specification_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - product_specifications
              - --source-feed-url
              - /Volumes/workspace/awin_products/raw_data/awin_feed_data/product_specifications.csv.gz
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: category_hierarchy_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - category_hierarchy
              - --source-feed-url
              - /Volumes/workspace/awin_products/raw_data/awin_feed_data/category_hierarchy.csv.gz
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: product_prices_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - pricing_and_savings
              - --source-feed-url
              - /Volumes/workspace/awin_products/raw_data/awin_feed_data/pricing_and_savings.csv.gz
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: images_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - product_images
              - --source-feed-url
              - /Volumes/workspace/awin_products/raw_data/awin_feed_data/product_images.csv.gz
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: ratings_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - ratings_and_reviews
              - --source-feed-url
              - /Volumes/workspace/awin_products/raw_data/awin_feed_data/ratings_and_reviews.csv.gz
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

        - task_key: product_identifiers_bronze        
          python_wheel_task:
            package_name: ingest_to_bronze
            entry_point: download_feed
            parameters:
              - "--catalog"
              - "mvp"
              - "--schema"
              - "bronze_feeds"
              - --table
              - product_identifiers
              - --source-feed-url
              - /Volumes/workspace/awin_products/raw_data/awin_feed_data/product_identifiers.csv.gz
              - --remove-all-null-columns
              - --write-mode
              - overwrite
              - --metadata-path
              - /Workspace/Users/ceberiloclaus@gmail.com/pos-puc-rio-mvp-engenharia-de-dados/metadata/bronze-table-descriptors.json
          environment_key: default

      environments:
        - environment_key: default
          spec:
            environment_version: "4"
            dependencies:
              - ../dist/*.whl
